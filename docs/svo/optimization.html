<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
<title>Voxel Compression</title>

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../css/darcula.css" rel="stylesheet" />
  <link href="../css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "SVO Optimization";
    var mkdocs_page_input_path = "svo/optimization.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/asm.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/ebnf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/cpp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/rust.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> VOXEL COMPRESSION</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Compression of Voxel Models</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Basics</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../properties.html">Properties of Voxel Models</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../statistical_tests.html">Statistical Tests to Determine Voxel Model Properties</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Related Work</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="../related/overview.md">None</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../related/voxel_formats.html">List of Voxel File Formats</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../related/literature.html">References</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Geometry Encoding</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../uncompressed.html">Uncompressed Format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rle/rle.html">Run-Length Encoding</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rle/space_filling_curves.html">Space-Filling Curves</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rle/hilbert_curves.html">3D Hilbert Curves</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="svo.html">Sparse Voxel Octree</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="construction.html">SVO Construction</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="optimization.html">SVO Optimization</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#single-octant-optimization">Single-Octant Optimization</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#complete-branch-optimization">Complete Branch Optimization</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../dag/dag.html">Directed Acyclic Graph</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cuboid_extraction.html">Cuboid Extraction</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Attribute Encoding</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../attribute_compression.html">SVO Attribute Compression</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Implementation</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../flvc/flvc.html">Free Lossless Voxel Compression (FLVC)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../flvc/flvc_optimizations.html">FLVC Data Stream</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../flvc/full_example.html">Full Example</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../flvc/results.html">FLVC Performance, Conclusions</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Auxiliary File Formats</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../file_formats/vl32.html">32-Bit Voxel List (VL32)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../file_formats/vlascii.html">ASCII Voxel List (VLASCII)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../file_formats/structlang.html">Structure Language (StructLang)</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">VOXEL COMPRESSION</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Geometry Encoding &raquo;</li>
        
      
    
    <li>SVO Optimization</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="svo-optimization">SVO Optimization</h1>
<p>Sparse Voxel Octrees are often sufficiently compact data structures for computer graphics applications.
However, they still contain a large amount of redundancy and have plenty of potential for optimization.</p>
<p>We can differentiate between two types of optimizations:<br>
<strong>top-down optimizations</strong> optimize nodes starting from the root node and continue downwards.
<strong>bottom-up optimizations</strong> optimize nodes starting from the leafs and continue upwards.</p>
<p><em>Top-down optimizations</em> alter the geometric boundaries of the octree but have little effect on the amount of nodes.
This is due to the fact that in any tree, there are more nodes towards the bottom.
Their primary purpose is accelerating access to the deeper layers.</p>
<p><em>Bottom-up optimizations</em> have no impact on the boundaries of the octree as this solely depends on the maximum depth.
Their primary purpose is decreasing the amount of nodes or reducing nodes in size.</p>
<p><span id="single-octant"></span></p>
<h2 id="single-octant-optimization">Single-Octant Optimization</h2>
<p><img alt="Octree Optimization" src="../img/graph/octree_optimization.svg" /><br>
<em>Figure 1: Octree Optimization, where b is a sub-branch (visualized using a Quadtree)</em></p>
<p>Once an octree has been fully constructed, unused octants can be optimized or "cut away" recursively.
This can be especially helpful for octrees where all voxels reside very far from the origin.
For instance, we could be encoding voxels with coordinates ranging from 100,000 to 100,050.
Many almost completely empty octree layers would need to be traversed to get to where such locations are stored.
Trimming away such single-octant layers accelerates encoding and decoding.</p>
<p>This is our first and only <em>top-down optimization</em>.</p>
<h3>Algorithm</h3>
<ol>
<li>
<script type="math/tex">s \gets (0,0,0)</script>
</li>
<li>If the root node <script type="math/tex">r</script> has exactly one branch <script type="math/tex">b</script>:<ul>
<li>
<script type="math/tex">s \gets s + 2^{d-2}</script>
</li>
<li>
<script type="math/tex">r \gets b</script>
</li>
<li>repeat 2.</li>
</ul>
</li>
</ol>
<p>
<script type="math/tex">2^d</script> is the negated minimum point of our current octree, as described in
<a href="#position-normalization">Position Normalization</a>.</p>
<p>After this process has been completed, we simply store <script type="math/tex">s</script> alongside the octree.
When decoding, <script type="math/tex">s</script> is added back onto all found positions.</p>
<p><span id="complete"></span></p>
<h2 id="complete-branch-optimization">Complete Branch Optimization</h2>
<p><img alt="Complete Branch Optimization" src="../img/graph/octree_complete_branches.svg" /><br>
<em>Figure 2: A Complete (Sub-)Tree</em></p>
<p>Observe the <em>Figure 2</em> above.
All nodes are completely filled with <code>1</code>, representing that their subtree or color is present.
This demonstrates one of the significant weak points of octrees:
They are very good at trimming away air recursively, but have a very high cost when encoding a completely filled
container.</p>
<p>In fact, we would be much better off encoding such containers as arrays than using octrees, as octrees only add 
redundancy and no benefit in this case.
To optimize such cases, we must eliminate nodes which are recursively filled in, or <em>complete</em>.
A voxel model that demonstrates this well is <em>chessmaster3</em>:</p>
<p><img alt="Chessmaster3" src="../img/model/chessmaster3.png" /><br>
<em>Figure 3: chessmaster3 Model, visualized in Magica Voxel</em></p>
<p>A very large portion of this model is completely filled in.
In fact, the cuboid base of this model alone is 1088x1088 large and many voxels tall.
When encoding this model, we see the following results:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Geometry Bytes</th>
</tr>
</thead>
<tbody>
<tr>
<td>SVX</td>
<td>1031 KiB</td>
</tr>
<tr>
<td>Octree</td>
<td>25044 KiB (~24x)</td>
</tr>
<tr>
<td>Tetrahexacontree</td>
<td>22704 KiB (~22x)</td>
</tr>
<tr>
<td>Octree Optimized</td>
<td>1340 KiB (~1.3x)</td>
</tr>
<tr>
<td>Thct. Optimized</td>
<td>4619 KiB (~4.5x)</td>
</tr>
</tbody>
</table>
<p>So how could we accomplish a seemingly miraculous drop from 24x worse to nearly identical for octrees?
By simply using the <em>degenerate case</em> of a zero-node to encode a complete subtree.</p>
<p><img alt="Complete Branch Optimization" src="../img/graph/octree_complete_branches_optimization.svg" /><br>
<em>Figure 4: The Tree from Figure 2, after optimization.</em></p>
<p>Compare the above figure to <em>Figure 2</em>. We are eliminating one layer of nodes and going from the root directly to
the color information.
Of course, the above data only includes geometry bytes, not color bytes.
By eliminating such layers, we can save ourselves 8 nodes on the second level from the bottom, 64 nodes on the third,
and so on.</p>
<p>Geometrically, it does not even require a lot of space to be completely filled.
We merely need a 4x4x4 volume of voxels to be complete in order to eliminate 8 nodes.
Tetrahexacontrees do not perform nearly as well though.
They require a 16x16x16 volume to be complete and only then is an optimization possible.
The more squashed an octree becomes, the fewer opportunities there are to optimize it.</p>
              
            </div>
          </div>
<footer></footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="construction.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../dag/dag.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML" defer></script>
      <script src="../js/mathjax_config.js" defer></script>
      <script src="../js/extra.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
